<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peer Network - Etherith</title>
    <link rel="stylesheet" href="/src/css/style.css">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="icon" href="/favicon.ico">
    <meta name="theme-color" content="#5865F2">
</head>
<body class="peers-page">
    <div class="container">
        <header class="app-header">
            <div class="logo">
                <h1>🧠 Etherith</h1>
            </div>
            <div class="user-profile" id="userProfile">
                <img id="userAvatar" class="avatar" src="" alt="User Avatar">
                <span id="userName">Loading...</span>
            </div>
        </header>

        <nav class="main-nav">
            <a href="/dashboard.html" class="nav-link">
                <span class="icon">🏠</span>
                Dashboard
            </a>
            <a href="/upload.html" class="nav-link">
                <span class="icon">📤</span>
                Upload Memory
            </a>
            <a href="/memories.html" class="nav-link">
                <span class="icon">🗂️</span>
                My Memories
            </a>
            <a href="/shared.html" class="nav-link">
                <span class="icon">🔗</span>
                Shared
            </a>
            <a href="/peers.html" class="nav-link active">
                <span class="icon">🌐</span>
                Peers
            </a>
        </nav>

        <main class="peers-content">
            <div class="page-header">
                <h2>🌐 Peer Network</h2>
                <p>Connect with other Etherith users and manage your peer-to-peer connections</p>
            </div>

            <div class="network-status-section">
                <h3>📊 Network Status</h3>
                <div class="status-grid">
                    <div class="status-card">
                        <div class="status-icon connected" id="nodeStatusIcon">●</div>
                        <div class="status-info">
                            <h4>Helia Node</h4>
                            <span id="nodeStatus">Initializing...</span>
                        </div>
                        <button id="nodeToggle" class="status-action">Start</button>
                    </div>
                    <div class="status-card">
                        <div class="status-icon" id="connectivityIcon">●</div>
                        <div class="status-info">
                            <h4>Connectivity</h4>
                            <span id="connectivityStatus">Checking...</span>
                        </div>
                        <button id="connectivityTest" class="status-action">Test</button>
                    </div>
                    <div class="status-card">
                        <div class="status-icon" id="dhtIcon">●</div>
                        <div class="status-info">
                            <h4>DHT Status</h4>
                            <span id="dhtStatus">Offline</span>
                        </div>
                        <button id="dhtToggle" class="status-action">Connect</button>
                    </div>
                </div>
            </div>

            <div class="node-info-section">
                <h3>🔧 Node Information</h3>
                <div class="node-details">
                    <div class="detail-item">
                        <strong>Peer ID:</strong>
                        <code id="nodePeerId" class="peer-id">Not connected</code>
                        <button id="copyPeerId" class="copy-btn" title="Copy Peer ID">📋</button>
                    </div>
                    <div class="detail-item">
                        <strong>Listening Addresses:</strong>
                        <div id="listeningAddresses" class="address-list">No addresses</div>
                    </div>
                    <div class="detail-item">
                        <strong>Protocol Version:</strong>
                        <span id="protocolVersion">libp2p/0.0.0</span>
                    </div>
                    <div class="detail-item">
                        <strong>Agent Version:</strong>
                        <span id="agentVersion">Helia/0.0.0</span>
                    </div>
                </div>
            </div>

            <div class="peers-section">
                <div class="section-header">
                    <h3>👥 Connected Peers</h3>
                    <div class="peer-controls">
                        <button id="refreshPeers" class="btn-secondary">🔄 Refresh</button>
                        <button id="connectPeer" class="btn-primary">➕ Connect Peer</button>
                    </div>
                </div>

                <div class="peers-stats">
                    <span id="peerCount">0 peers connected</span>
                    <span id="bandwidthStats">0 B/s ↑ 0 B/s ↓</span>
                </div>

                <div id="peersGrid" class="peers-grid">
                    <div class="empty-state" id="peersEmptyState">
                        <div class="empty-icon">🌐</div>
                        <h3>No peers connected</h3>
                        <p>Start your node to connect with other Etherith users</p>
                        <button id="startNodeBtn" class="btn-primary">Start Node</button>
                    </div>
                </div>
            </div>

            <div class="discovery-section">
                <h3>🔍 Peer Discovery</h3>
                <div class="discovery-methods">
                    <div class="discovery-card">
                        <div class="discovery-icon">🌍</div>
                        <h4>Bootstrap Nodes</h4>
                        <p>Connect to known IPFS bootstrap nodes</p>
                        <button id="connectBootstrap" class="discovery-action">Connect</button>
                    </div>
                    <div class="discovery-card">
                        <div class="discovery-icon">📡</div>
                        <h4>mDNS Discovery</h4>
                        <p>Find peers on your local network</p>
                        <button id="toggleMdns" class="discovery-action">Enable</button>
                    </div>
                    <div class="discovery-card">
                        <div class="discovery-icon">🔄</div>
                        <h4>DHT Discovery</h4>
                        <p>Find peers through the distributed hash table</p>
                        <button id="dhtDiscovery" class="discovery-action">Search</button>
                    </div>
                </div>
            </div>

            <div class="bandwidth-section">
                <h3>📊 Bandwidth Usage</h3>
                <div class="bandwidth-chart">
                    <canvas id="bandwidthChart" width="400" height="200"></canvas>
                </div>
                <div class="bandwidth-stats-grid">
                    <div class="bandwidth-stat">
                        <strong>Total Upload:</strong>
                        <span id="totalUpload">0 B</span>
                    </div>
                    <div class="bandwidth-stat">
                        <strong>Total Download:</strong>
                        <span id="totalDownload">0 B</span>
                    </div>
                    <div class="bandwidth-stat">
                        <strong>Current Upload:</strong>
                        <span id="currentUpload">0 B/s</span>
                    </div>
                    <div class="bandwidth-stat">
                        <strong>Current Download:</strong>
                        <span id="currentDownload">0 B/s</span>
                    </div>
                </div>
            </div>

            <div id="connectPeerModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Connect to Peer</h3>
                        <button id="closeConnectModal" class="close-btn">✕</button>
                    </div>
                    <div class="modal-body">
                        <div class="connect-form">
                            <div class="form-group">
                                <label for="peerAddress">Peer Address:</label>
                                <input type="text" id="peerAddress" placeholder="/ip4/127.0.0.1/tcp/4001/p2p/QmPeerID..." class="peer-address-input">
                                <small>Enter a multiaddr format peer address</small>
                            </div>
                            <div class="example-addresses">
                                <h4>Example addresses:</h4>
                                <button class="example-address" data-address="/ip4/104.131.131.82/tcp/4001/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ">Bootstrap Node 1</button>
                                <button class="example-address" data-address="/ip4/104.131.131.82/udp/4001/quic/p2p/QmaCpDMGvV2BGHeYERUEnRQAwe3N8SzbUtfsmvsqQLuvuJ">Bootstrap Node 2</button>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="cancelConnect" class="btn-secondary">Cancel</button>
                        <button id="confirmConnect" class="btn-primary">Connect</button>
                    </div>
                </div>
            </div>

            <div id="peerDetailsModal" class="modal hidden">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>Peer Details</h3>
                        <button id="closePeerModal" class="close-btn">✕</button>
                    </div>
                    <div class="modal-body">
                        <div class="peer-details">
                            <div class="detail-section">
                                <h4>📋 Basic Information</h4>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <strong>Peer ID:</strong>
                                        <code id="modalPeerId" class="peer-id"></code>
                                    </div>
                                    <div class="detail-item">
                                        <strong>Connection:</strong>
                                        <span id="modalConnectionStatus"></span>
                                    </div>
                                    <div class="detail-item">
                                        <strong>Protocol:</strong>
                                        <span id="modalProtocol"></span>
                                    </div>
                                    <div class="detail-item">
                                        <strong>Latency:</strong>
                                        <span id="modalLatency">Unknown</span>
                                    </div>
                                </div>
                            </div>
                            <div class="detail-section">
                                <h4>📊 Statistics</h4>
                                <div class="detail-grid">
                                    <div class="detail-item">
                                        <strong>Data Sent:</strong>
                                        <span id="modalDataSent">0 B</span>
                                    </div>
                                    <div class="detail-item">
                                        <strong>Data Received:</strong>
                                        <span id="modalDataReceived">0 B</span>
                                    </div>
                                    <div class="detail-item">
                                        <strong>Connected Since:</strong>
                                        <span id="modalConnectedSince">Unknown</span>
                                    </div>
                                </div>
                            </div>
                            <div class="detail-section">
                                <h4>🌐 Addresses</h4>
                                <div id="modalPeerAddresses" class="address-list"></div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button id="disconnectPeer" class="btn-danger">Disconnect</button>
                        <button id="pingPeer" class="btn-secondary">Ping</button>
                    </div>
                </div>
            </div>
        </main>

        <footer class="app-footer">
            <p>Connected to the decentralized IPFS network</p>
        </footer>
    </div>

    <script type="module" src="/src/js/main.js"></script>
    <script type="module" src="/src/js/peers.js"></script>
</body>
</html>